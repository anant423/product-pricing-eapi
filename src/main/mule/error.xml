<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<error-handler name="eapi-error-handler" doc:id="67ce4044-0f53-4569-b0c9-99cc8795545a" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="af002535-7813-41ef-a3c9-f20db37b54b4" type="EXT:CANT_INVOKE_BACKEND" when='#[(error.errorType.namespace ++ ":" ++ error.errorType.identifier)=="MULE:RETRY_EXHAUSTED"]'>
			<logger level="INFO" doc:name="Log Error" doc:id="e1f45eee-6628-4d04-8d29-4a8b38a12875" message="Error=#[error.description]" />
			<ee:transform doc:name="Error Payload" doc:id="a948e984-5e3b-4bc5-8fea-3d551bc3c111">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	"statusCode": 500,
	"error": error.description
}]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<raise-error doc:name="EXT:RETRY_EXHAUSTED" doc:id="efee1358-b0b7-43ec-9137-6e3188eb45be" description="#[error.description]" type="EXT:RETRY_EXHAUSTED"/>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="9f404107-2e01-411b-a534-9ce0060e6552" type="EXT:CANT_INVOKE_BACKEND">
			<logger level="INFO" doc:name="Log Error" doc:id="821670be-8bab-44be-8f0d-0a96fca058c3" message="Error=#[error.description]" />
			<ee:transform doc:name="Error Payload" doc:id="0e07c5bf-b4a5-453e-9641-76eabf659816">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	"statusCode": 500,
	"error": error.description
}]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<raise-error doc:name="EXT:ANY" doc:id="51513a62-456b-483e-bc44-8b792ea6cccd" description="#[error.description]" type="EXT:ANY"/>
		</on-error-propagate>
	</error-handler>
</mule>
